jQuery((function($){$(document).on("wpbs_dates_selected",(function(event,$calendar_instance){if(void 0===$calendar_instance.find(".wpbs-container").data("start_date")||""==$calendar_instance.find(".wpbs-container").data("start_date"))return!1;if(start_date=new Date($calendar_instance.find(".wpbs-container").data("start_date")),void 0===$calendar_instance.find(".wpbs-container").data("end_date")||""==$calendar_instance.find(".wpbs-container").data("end_date"))return!1;if(end_date=new Date($calendar_instance.find(".wpbs-container").data("end_date")),!start_date||!end_date)return!1;$calendar=$calendar_instance.find(".wpbs-container");var sources=[],limits={};$calendar_instance.find(".wpbs-form-field-inventory-dropdown").each((function(){sources.push($(this).data("source")),limits[$(this).data("source")]=$(this).parents(".wpbs-form-field-inventory").find(".wpbs-form-field-inventory-limit").val()}));var data={action:"wpbs_get_available_inventory"};data.start_date=start_date.getTime(),data.end_date=end_date.getTime(),data.calendar_id=$calendar.data("id"),data.limits=limits,data.sources=sources,data.form_id=$calendar_instance.find(".wpbs-form-container").data("id"),data.language=$calendar.data("language"),$.post(wpbs_inv_ajax.ajaxurl,data,(function(response){response=JSON.parse(response),$calendar_instance.find(".wpbs-form-field-inventory-dropdown").each((function(){var calendar_id=$(this).data("source");max_inventory=parseInt(response[calendar_id].max_inventory);var $inventory_field=$('.wpbs-form-field-inventory-dropdown[data-source="'+calendar_id+'"]').parents(".wpbs-form-field-inventory");$inventory_field.find(".wpbs-form-field-inventory-maximum").val(max_inventory),$inventory_field.find(".wpbs-form-field-inventory-dropdown option").remove(),$inventory_field.find(".wpbs-form-field-inventory-dropdown").data("placeholder-enabled")&&$inventory_field.find(".wpbs-form-field-inventory-dropdown").append($("<option>",{text:$inventory_field.find(".wpbs-form-field-inventory-dropdown").data("placeholder-enabled"),selected:!0,disabled:!0})),$.each(response[calendar_id].inventory_options,(function(value,label){$inventory_field.find(".wpbs-form-field-inventory-dropdown").append($("<option>",{value:value,text:label}))}))})),$(document).trigger("wpbs_form_updated",[$calendar_instance,$calendar_instance.find(".wpbs-form-container").data("id")])}))})),$(".wpbs-main-wrapper").each((function(){$(document).trigger("wpbs_dates_selected",[$(this)])})),$(document).on("wpbs_dates_deselected",(function(event,$calendar_instance){$calendar_instance.find(".wpbs-form-field-inventory-dropdown option").remove(),$calendar_instance.find(".wpbs-form-field-inventory-dropdown").append($("<option>",{text:$calendar_instance.find(".wpbs-form-field-inventory-dropdown").data("placeholder-disabled"),selected:!0,disabled:!0}))}))}));